---
title: "Manuscripts in Rmarkdown"
author: "Brad Duthie"
date: "25 October 2018"
output: html_document
bibliography: notes_refs.bib
link-citations: yes
linkcolor: blue
biblio-style: apalike
---


Contents
================================================================================

********************************************************************************

**Note: Please think of this document as a living document, which anyone is free to improve (like a [wiki](https://en.wikipedia.org/wiki/Wiki)) with minor edits, new sections that others might find useful, or [additional resources](#whatelse) that might be helpful. After reading through this, readers should be able to start writing manuscripts in Rmarkdown, integrating references using [BibTeX](https://en.wikipedia.org/wiki/BibTeX), analyses with R, and equations through [LaTeX](https://en.wikipedia.org/wiki/LaTeX) code if need be. The objective is not to make the reader an expert at Rmarkdown, but to give the reader the confidence to start writing in Rmarkdown and motivation to do so when starting any new document**

********************************************************************************

- [Introduction to Rmarkdown](#what_is_rmd)
- [Practical differences between Rmarkdown and Word](#practical_diffs)

********************************************************************************

<a name="what_is_rmd">Introduction to Rmarkdown</a>
================================================================================

Rmarkdown is a type of file (extension '.Rmd') that is used to make documents that are easily integrated with R. Within [Rstudio](https://www.rstudio.com/), a document can be written in Rmarkdown, then converted seemlessly to high quality HTML, PDF, or DOCX formats. Because Rmarkdown files are [text files](https://en.wikipedia.org/wiki/Text_file), they can be viewed and edited in [any text editor](https://en.wikipedia.org/wiki/List_of_text_editors) (e.g., Notepad, gedit) or [integrated development environment](https://en.wikipedia.org/wiki/Integrated_development_environment) (e.g., Rstudio, vim, emacs). Text files are also easy to work with in [version control](https://stirlingcodingclub.github.io/version_control/vc_notes.html) and on [GitHub](https://github.com/) because version control (e.g., git) can track the line by line changes over time in a way that cannot be done with non text files (i.e., [binary](https://en.wikipedia.org/wiki/Binary_file) files). Other examples of text files are files with the extensions .txt, .R, .c, .csv, .md, .html, .xml; binary files include files with the extensions .jpg, .mp3, .doc, .ppt, .exe (note that .docx or .xlsx files are zipped .xml files, so something with these extensions cannot be opened in a text editor, but is not technically a binary). For now, **all that is important to know is that .Rmd files can be opened and edited in Rstudio, and turned into HTML, PDF, or DOCX files with the push of a button**.

Getting started with writing simple documents in Rmarkdown takes very little time in Rstudio. In fact, when initialising a new Rmarkdown document within Rstudio (in Rstudio, select `File > New File > R Markdown`), some example text and R code is initialised to help demonstrated how it works; this sample text can be immediately turned into an HTML, PDF, or DOCX using the 'Knit' icon in the Rmarkdown toolbar.

<br>
<center>
![The 'Knit' pull-down option is shown in blue](images/Rstudio_toolbar.png)
</center>
<br>

It is not immediately obvious what the advantage is for doing any of this, particularly for people who are already comfortable writing in Word (or LaTeX). My hope is that the advantages will become clear as I demonstrate how to write a manuscript in Rmarkdown Some of these advantages will be obvious features of Rmarkdown, including the ability to do the following: integrate R code directly (avoiding the need to awkwardly copy-paste analyses, tables, or figures), use BibTeX (to easily add citations, properly formatted for a specific journal), integrate LaTeX equations, add links, and add HTML code and comments.  Other advantages will be more subtle, and include the ability to integrate more easily with version control software such as git, and to focus more clearly on the process of writing rather than formatting the document. I will explain this latter advantage in more detail in the next section, comparing how writing in Rmarkdown differs from writing in Word, in practice.

Rmarkdown is still fairly new, having been first released in 2012 [@Xie2018], not long after the initial release of Rstudio in 2011. The ability to write high quality documents in Rmarkdown is possible because of the work of the [Rstudio team](https://www.rstudio.com/about/), and especially the developer [Yihui Xie](https://yihui.name/). Before this, the options were pretty much limited to Microsoft Word and LaTeX. Having written manuscripts in all three, I am convinced that Rmarkdown is the most useful and most efficient way to do scientific writing. The essential tools for getting started can be learned in minutes, with the more advanced options being learned along the way fairly painlessly as needed.

<a name="practical_diffs">Practical differences between Rmarkdown and Word</a>
================================================================================

Most biologists write manuscripts in Miscrosoft Word. There is nothing wrong with this, but Microsoft Word and other word processors are not written with scientific writing in mind. And the prevalence of word processors makes the inconveniences associated with using them to do scientific writing go largely unrecognised; we are used to it. Page breaks and formatting can be difficult to specify as desired. Figures need to be copied and pasted into the text (or attached separately). Table elements from statistical output often need to be copied and pasted, or written from scratch. Within-text values calculated from data need to likewise be copied into Word directly. All of this takes time, and these processes need to be repeated if something in the analysis changes affecting figures, tables, or summary statistics. **In the long-term, the biggest practical difference between writing in Rmarkdown versus Word is to greatly increase the efficiency from data to professional looking output.**

**In the short-term, however, the biggest practical difference between Rmarkdown and Word is the writing environment**. It is easy to see what the output of a Word document is going to look like while it is being written; [what you see is what you get (WYSIWYG)](https://en.wikipedia.org/wiki/WYSIWYG). In Rmarkdown, this is not the case. Writing is done in plain text, and the final output looks different from how the content looks while it is being written. In this way, writing in Rmarkdown is more similar to writing in [LaTeX](https://en.wikipedia.org/wiki/LaTeX), another plain text writing tool that can produce nice looking [PDF outputs](https://www.biorxiv.org/content/biorxiv/early/2017/09/24/136093.full.pdf), but has a [high learning curve](https://github.com/bradduthie/pre_post_cop/blob/master/pre_post_biorxiv.tex) to use effectively. The separation between plain text writing and final output can be a bit intimidating at first, or at least a bit unintuitive, but there are many practical reasons for it. Having everything assembled at once and only when desired means that key processes (e.g., paragraph formatting, text spacing, addition of references, etc.) do not need to be ongoing *during* the writing process, and this tends to make the organisation and type-setting of the final document look more professional. More subtley, it allows writers to separate the **content** of the writing from the **output**. If a formatting error occurs in Word (e.g., tabs or a figure are out of place), then it immediately disrupts the thought process of writing; by isolating the written content from how it looks in the output, such disruptions do not occur. Nevertheless, getting used to this type of workflow takes some time. 

In the next section, I will ease the reader into this work flow by introducing the Rstudio environment for writing in Rmarkdown, demonstrate a simple example of how Rmarkdown can be used to write a manuscipt abstract, then 'knit' this abstract into an HTML, PDF, or DOCX output.

Writing an abstract in Rstudio
================================================================================

After opening Rstudio, the option to create a new Rmarkdown file can be accessed by navigating to 'File', scrolling down to 'New File', then selecting 'R Markdown...'. Alternatively, it can be accessed by selecting the icon directly below 'File' (see below) and choosing 'R Markdown...'. 

<br>
<center>
![](images/top_bar.png)
</center>
<br>

In either case, a box will pop up that looks like the one below, which asks for a title and author. It will also ask for a default output format, but this really is not important to specify; all will be possible and easy to choose regardless of the default selected.

<br>
<center>
![](images/new_Rmarkdown.png)
</center>
<br>

In addition to writing an Rmarkdown document, the options on the left also allow for writing a presentation or [shiny](https://shiny.rstudio.com/) document in Rmarkdown. I will not discuss how to do this in the current document, but a general understanding of Rmarkdown will make creating slides and shiny presentations much easier. After clicking 'OK', Rstudio will create a new Rmarkdown document, complete with some sample text that looks something like the below (the colour scheme might differ, of course).

<br>
<center>
![](images/default_rmd.png)
</center>
<br>

This code is demonstrating some of the features of Rmarkdown, including the integration of R code directly into the document. Seeing the output of this is possible by simply clicking the 'Knit' button in the tool bar, as shown below.

<br>
<center>
![The 'Knit' pull-down option is shown in blue](images/Rstudio_toolbar.png)
</center>
<br>

Clicking the 'Knit' button will produce an HTML (or PDF or DOCX) with the R analysis run as written in the code; the output should appear when finished in whatever format has been requested. If there are package missing that are needed to knit everything properly, Rstudio will ask to install these first. This simple starting example provides a flavour of what Rmarkdown is capable of doing, but I want to instead start from scratch and focus on process of writing an abstract. I will therefore remove everything after line 5 above until the Rmd file looks like the below.

```{YAML}
---
title: "Untitled"
output: html_document
---
    
```

The text between the top and bottom `---` dashes is a [YAML header](https://en.wikipedia.org/wiki/YAML) header (YAML stands for 'Yet Another Markup Language'). It is not important to understand YAML or know how this header works; it is actually entirely optional. But keeping it in place is helpful, and as I continue to write my example manuscript, I will add to it to show some useful tricks. The first such trick will be to add a title, subtitle and author, which is shown below.

```{YAML}
---
title: "High sparrow body length decreases survival"
subtitle: "A demonstration of Rmarkdown using Herman Bumpus' data"
author: Brad Duthie
output: html_document
---
    
```

Essentially, the YAML header allows authors to specify key information to be used when producing the final document (i.e., meta data). I will now move onto the Rmarkdown text itself, starting with the abstract title and the abstract itself. Directly below the YAML header, I will add the text below.

```
---
title: "High sparrow body length decreases survival"
subtitle: "A demonstration of Rmarkdown using Herman Bumpus' data"
author: Brad Duthie
output: html_document
---
    
Abstract
===============================================================================
  
Writing documents in Rmarkdown using Rstudio can make scientific workflow more efficient, and here I demonstrate how a scientific manuscript can be written using a classical data set first published by Herman Bumpus. I integrate Bumpus' data with Rmarkdown to produce a sample manuscript, testing whether or not sparrow body length decreases survival following a storm in southern New England. Using a t-test, I show that surviving birds have lower body length than birds that do not survive. All analyses of data are incorporated into the underlying Rmarkdown document, including figures and a table. References are incorporated using BibTeX. The underlying code for this manuscript is publicly available [on GitHub](https://github.com/StirlingCodingClub/Manuscripts_in_Rmarkdown) as part of the Stirling Coding Club organisation.
```

Two things are worth pointing out in the code above. First, the extended `===` underneath the word 'Abstract'; this tells Rmarkdown to create a title in the output. Second, the words 'on GitHub' make a link to the Stirling Coding Club website; the square brackets indicate the words to appear linked `[on GitHub]`, while the parentheses that immediately follow specify the URL. Both of these tools are available in basic markdown too (i.e., .md files). 

We can take a quick break here and see what the output of the document looks like as an HTML file. I have saved the file above as 'ms.Rmd', and we can see the output by clicking the 'Knit' button in the Rstudio toolbar.

<br>
<center>
![The 'Knit' pull-down option is shown in blue](images/Rstudio_toolbar.png)
</center>
<br>

[Here](https://stirlingcodingclub.github.io/Manuscripts_in_Rmarkdown/ms_history/ms_abstract.html) is what the output looks like in HTML. The title, subtitle, and author have been included, the abstract is recognised as a title, and the link is included appropriately. Of course, in most cases, the output of a manuscrpit would be much better as a PDF or DOCX than an HTML file. To instead get a PDF, it is easy to simply select the pull down from the 'Knit' button and choose 'PDF' instead of 'HTML'. 

<br>
<center>
![The 'Knit' pull-down option is shown in blue](images/knit_pulldown.png)
</center>
<br>

Rstudio immediately starts to produce a file 'ms.pdf' instead of 'ms.html', and adjust the YAML header of 'ms.Rmd' to include a PDF output, as shown below.

```{YAML}
---
title: "High sparrow body length decreases survival"
author: "Brad Duthie"
subtitle: A demonstration of Rmarkdown using Herman Bumpus' data
output:
  pdf_document: default
  html_document: default
---
```

Now there are two options available (`pdf_document` and `html_document`), and Rstudio has produced the same manuscript file as a PDF rather than an HTML. Of course, many journals and colleagues prefer to read and receive manuscripts as DOCX files, so now is also a good time to use the knit pull-down menu and choose the 'Knit to Word' option to create a DOCX that can be opened and edited in Microsoft Word or some other word processor (e.g., [Libre Office](https://www.libreoffice.org/)). Again, Rmarkdown adjusts the YAML header to include a `word_document` in the output and produces a DOCX version of 'ms.Rmd'. 

Note that the DOCX version is formatted a bit strangely, with titles coloured in light blue, which is not really desirable for scientific manuscripts. Other formatting issues leave a lot to be desired; the text is not double-spaced and there are no line or page numbers. To fix this, we could edit these formatting options directly in Word, but this would be tedious because it would be necessary to repeat this every time a new DOCX was created using the knit function in Rstudio. Instead, **we can ensure that the created DOCX is formatted as desired every time by using a template DOCX**. 




********************************************************************************

Some notes to get started:

- Introduce the general idea of WYSIWYG and word processors, contrasting with DOCX files
- Introduce non-WYSIWYG markup langauges (like HTML)
- Discuss LaTeX and Word, and the costs and benefits of each
- Present Rmarkdown as a sort of compromise between the two, usable easily in Rstudio
- Discuss the costs and benefits of Rmarkdown, particularly in the context of scientific writing
- Emphasise that LaTeX code can be integrated, as can R code, and a PDF, HTML, or DOCX can be produced with Knitr

Show how to do this:

- Start by introducing the environment in Rstudio
    - The text-editor area
    - The Knit button
    - The [YAML header](https://en.wikipedia.org/wiki/YAML), and that we will build off of it
- Next just focus on writing a very brief Abstract
    - Summarise the paper to be written
    - Add some comments to show how this is done
- Show how to use the Knit button to produce a PDF of the abstract
- Add a two paragraph introduction, complete with a few references.
    - One paragraph on the story of Bumpus
    - A second paragraph on what this paper will do
- Now introduce how to incorporate the references using a very small bibtex file
    - Insert a references section at the end
    - Produce the PDF again, showing the abstract, introduction, and references
    - Now show the same thing, but producing an HTML instead
    - Finally, produce a DOCX instead
        - But wait, this looks weird; can't we make it nicer?
        - Introduce a template DOCX file so that it can be made to look like a manuscript
    - Show a revised DOCX that could be sent to colleagues
- Write up a quick methods section
    - A short paragraph on sparrows
    - Add a picture of a sparrow as Figure 1
    - State that we're going to compare bird length in living versus dead sparrows
    - Will use a simple t-test in R
    - Stop to show the result as a PDF
- Write up a Results section
    - Show how to read data into Rmarkdown
    - Do the analysis in R within the results section
    - Show how to output summary statistics and statistical test results from the analysis
    - Make plots inside R markdown that show up in the results
    - Stop to show the result as a PDF
- Write up a Discussion section
    - Very brief summary of the results
    - Focus more on on explaining how this is all done in Rmarkdown
    - Add some embedded links, maybe some other Rmarkdown tricks
    - Show the finish product as a PDF, HTML, and word

Point out where everything is to replicate all of the above (make this a single folder)

- The Rmd file itself
- The data
- The images
- The bibtex file
- The relevant DOCX template

Discuss some other features that are useful once you get the hang of things

- Easy switch between formats using CSL files
- Beautiful mathematics using LaTeX
- Add LaTeX packages, such as headers
- Links to different sections of the document 
- Add some of these, then produce a new PDF and DOCX
- Link to a few manuscripts written in Rmarkdown
- Show how to convert a Rmd to a TEX file

Emphasise that anyone who wants to do the same as above can fork the [GitHub Repository](https://github.com/StirlingCodingClub/Manuscripts_in_Rmarkdown) and insert their own text. Point out the benefit of being able to use version control with the Rmd file. 

Make some concluding points to distinguish between what I've done above that is important, and what is arbitrary and really just my own style (e.g., how to organise the directory). Mention that the same Rmarkdown code used to make documents is also the basis for making slides in Rmarkdown, an example of which will be available in a link in the repository. Also discuss that this is the first step toward creating shiny, interactive, documents and slides.

References
=======================================================

